# Company Fleet API · Laravel 12 + Docker

## 1. Задача

Внутри компании каждому сотруднику необходимо быстро определить, какие служебные автомобили **свободны** для поездки в заданный промежуток времени и **допустимы** для его должности с точки зрения категории комфорта.

---

## 2. Как развернуть приложение

```bash
# Клонируем репозиторий и переходим в папку
$ git clone https://…/OnlyTest.git
$ cd OnlyTest

# 1️⃣ Переменные окружения
#   ─────────────────────
# a) корневой файл для docker‑compose (DB_*, WEB_PORT, etc.)
$ cp .env.example .env      # редактируем при желании порт, пароли

# b) .env приложения
$ cp app/.env.example app/.env   # внутри контейнера php это увидит Laravel
#    (при первом запуске скрипт всё равно сгенерирует APP_KEY)

# 2️⃣ Делаем helper‑скрипт исполняемым (один раз)
$ chmod +x start.sh

# 3️⃣ Поднимаем стек, выполняем миграции + сидеры
$ ./start.sh --seed
```

Скрипт выполняет:

1. **Сборку** образов `php`, `nginx`, запуск `mysql` (именованный volume `mysql_data`).
2. Генерацию `APP_KEY`, кеширование конфигов.
3. `migrate --seed` — заливаются должности, категории, 5 машин, 16 сотрудников, тестовые поездки.
4. Вывод финального URL: [http://localhost:8080](http://localhost:8080)

---

## 3. Postman‑коллекция и Swagger

| Файл                               | Назначение                                                                                                                                         |
| ---------------------------------- |----------------------------------------------------------------------------------------------------------------------------------------------------|
| `OnlyTest.postman_collection.json` | **Полный набор запросов** с готовыми окружениями и примерными ответами для каждого энд‑поинта. Импортируйте в Postman → *Environments › OnlyTest*. |
| `swagger.yaml`                     | Описание API в формате **OpenAPI 3.0**. Можно открыть в Swagger UI или Redoc; все схемы и параметризованные запросы уже настроены.                 |

---

## 4. Сводка маршрутов API

| Группа | Метод    | URI                   | Описание                                                       |
| ------ | -------- | --------------------- |----------------------------------------------------------------|
| Auth   | `POST`   | `/api/auth/login`     | Логин сотрудника, выдаёт `access_token`.                       |
| Auth   | `POST`   | `/api/auth/refresh`   | Продление токена.                                              |
| Auth   | `GET`    | `/api/auth/me`        | Профиль текущего сотрудника.                                   |
| Auth   | `POST`   | `/api/auth/logout`    | Выход (инвалидация токена).                                    |
| Cars   | `GET`    | `/api/available-cars` | Список машин, свободных в интервале и подходящих по категории. |
| Trips  | `GET`    | `/api/trips`          | Все поездки сотрудника.                                        |
| Trips  | `POST`   | `/api/trips`          | Создать поездку.                                               |
| Trips  | `PATCH`  | `/api/trips/{id}`     | Изменить статус (`planned/approved/cancelled`).                |
| Trips  | `DELETE` | `/api/trips/{id}`     | Отменить поездку.                                              |

> Все маршруты (кроме `login`/`refresh`) требуют заголовок `Authorization: Bearer <token>`.

---

**Иван Комиссаров** 2025
